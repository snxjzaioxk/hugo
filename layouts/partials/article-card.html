{{/*
  Article Card Component
  可复用的文章卡片组件

  参数:
  - . (context): 文章页面对象
  - showDate: 是否显示日期 (可选，默认从配置读取)
  - cardStyle: 卡片样式 "default" | "compact" (可选，默认 "default")
  - showPinned: 是否显示置顶标记 (可选，默认 true)
*/}}

{{ $article := . }}
{{ $showDate := .showDate | default false }}
{{ $cardStyle := .cardStyle | default "default" }}
{{ $showPinned := .showPinned | default true }}

{{ if reflect.IsMap . }}
  {{ $article = .article }}
  {{ $showDate = .showDate | default false }}
  {{ $cardStyle = .cardStyle | default "default" }}
  {{ $showPinned = .showPinned | default true }}
{{ end }}

{{ with $article }}
  {{ if eq $cardStyle "compact" }}
    {{/* 紧凑样式 - 用于分类页 */}}
    <article class="post-item bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm hover:shadow-md transition-all duration-300">
      <div class="space-y-4">
        <div class="flex items-center justify-between">
          {{ if $showDate }}
            <time class="text-sm text-gray-500 dark:text-gray-400">
              {{ .Date.Format "2006-01-02" }}
            </time>
          {{ end }}
          {{ if .ReadingTime }}
            <span class="text-sm text-gray-500 dark:text-gray-400">{{ .ReadingTime }} 分钟阅读</span>
          {{ end }}
        </div>

        <h2 class="text-xl font-semibold text-gray-800 dark:text-gray-200 hover:text-blue-600 dark:hover:text-blue-400 transition-colors duration-200">
          <a href="{{ .RelPermalink }}">
            {{ .Title }}
          </a>
        </h2>

        {{ if .Summary }}
          <p class="text-gray-600 dark:text-gray-400 text-sm line-clamp-2">
            {{ .Summary | truncate 120 }}
          </p>
        {{ end }}

        {{ if .Params.tags }}
          <div class="flex flex-wrap gap-2">
            {{ range first 3 .Params.tags }}
              <span class="bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 px-2 py-1 rounded text-xs">
                {{ . }}
              </span>
            {{ end }}
          </div>
        {{ end }}
      </div>
    </article>

  {{ else }}
    {{/* 默认样式 - 用于主页和列表页 */}}
    <article class="article-item bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm hover:shadow-lg transition-all duration-300">
      <div class="flex items-start justify-between">
        <div class="flex-1">
          <h3 class="text-xl font-semibold mb-3">
            <a href="{{ .RelPermalink }}" class="text-gray-800 dark:text-gray-200 hover:text-blue-600 dark:hover:text-blue-400 transition-colors duration-200">
              {{ .Title }}
            </a>
          </h3>

          {{ if .Summary }}
            <p class="text-gray-600 dark:text-gray-400 mb-4 line-clamp-2">
              {{ .Summary | truncate 180 }}
            </p>
          {{ end }}

          <div class="flex items-center justify-between">
            <div class="flex items-center space-x-4 text-sm text-gray-500 dark:text-gray-400">
              {{ if $showDate }}
                <time class="text-sm">
                  {{ .Date.Format "2006-01-02" }}
                </time>
              {{ end }}
              {{ with .Params.categories }}
                <span class="bg-blue-100 dark:bg-blue-800 text-blue-600 dark:text-blue-400 px-2 py-1 rounded-full text-xs">
                  {{ index . 0 }}
                </span>
              {{ end }}
            </div>
            {{ with .Params.tags }}
              <div class="flex space-x-2">
                {{ range first 3 . }}
                  <span class="bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 px-2 py-1 rounded-full text-xs">
                    #{{ . }}
                  </span>
                {{ end }}
              </div>
            {{ end }}
          </div>
        </div>

        {{ if and $showPinned (le (.Params.weight | default 999) 10) }}
          <div class="ml-4 flex-shrink-0">
            <span class="bg-red-100 dark:bg-red-900 text-red-600 dark:text-red-400 px-3 py-1 rounded-full text-sm font-medium">
              📌 置顶
            </span>
          </div>
        {{ end }}
      </div>
    </article>
  {{ end }}
{{ end }}
