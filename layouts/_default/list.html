{{ define "main" }}
  <div class="max-w-4xl mx-auto px-4 py-8">
    <header class="mb-8">
      <h1 class="text-3xl font-bold text-gray-800 dark:text-gray-200 mb-2">{{ .Title }}</h1>
      <p class="text-gray-600 dark:text-gray-400">共 {{ len .Pages }} 篇文章</p>
    </header>

    {{ if .Content }}
      <div class="prose dark:prose-invert mb-8">
        {{ .Content }}
      </div>
    {{ end }}

    {{ if .Pages }}
      <section class="articles-list">
        <!-- 分页器：确保按时间倒序并支持分页 -->
        {{ $paginator := .Paginate (.Pages.ByDate.Reverse) 10 }}
        {{ $groupByYear := .Params.groupByYear | default (site.Params.list.groupByYear | default true) }}

        {{ if $groupByYear }}
          {{ range $paginator.Pages.GroupByDate "2006" }}
            <div class="year-group mb-10">
              <h2 class="text-2xl font-semibold text-gray-700 dark:text-gray-300 mb-6 border-b border-gray-200 dark:border-gray-700 pb-2">
                {{ .Key }}年
              </h2>
              <div class="grid gap-6">
                {{ range .Pages }}
                  <article class="article-item bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm hover:shadow-lg transition-all duration-300">
                    <div class="flex items-start justify-between">
                      <div class="flex-1">
                        <h3 class="text-xl font-semibold mb-3">
                          <a href="{{ .RelPermalink }}" class="text-gray-800 dark:text-gray-200 hover:text-blue-600 dark:hover:text-blue-400">
                            {{ .Title }}
                          </a>
                        </h3>
                        {{ if .Summary }}
                          <p class="text-gray-600 dark:text-gray-400 mb-4 line-clamp-2">
                            {{ .Summary | truncate 180 }}
                          </p>
                        {{ end }}
                        <div class="flex items-center justify-between">
                          <div class="flex items-center space-x-4 text-sm text-gray-500 dark:text-gray-400">
                            <time datetime="{{ .Date.Format "2006-01-02" }}">
                              {{ .Date.Format "1月2日" }}
                            </time>
                            <span>{{ .ReadingTime }}分钟阅读</span>
                            {{ with .Params.categories }}
                              <span class="bg-blue-100 dark:bg-blue-800 text-blue-600 dark:text-blue-400 px-2 py-1 rounded-full text-xs">
                                {{ index . 0 }}
                              </span>
                            {{ end }}
                          </div>
                          {{ with .Params.tags }}
                            <div class="flex space-x-2">
                              {{ range first 3 . }}
                                <span class="bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 px-2 py-1 rounded-full text-xs">
                                  #{{ . }}
                                </span>
                              {{ end }}
                            </div>
                          {{ end }}
                        </div>
                      </div>
                      {{ if le (.Params.weight | default 999) 10 }}
                        <div class="ml-4 flex-shrink-0">
                          <span class="bg-red-100 dark:bg-red-900 text-red-600 dark:text-red-400 px-3 py-1 rounded-full text-sm font-medium">
                            📌 置顶
                          </span>
                        </div>
                      {{ end }}
                    </div>
                  </article>
                {{ end }}
              </div>
            </div>
          {{ end }}
        {{ else }}
          <div class="grid gap-6">
            {{ range $paginator.Pages }}
              <article class="article-item bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm hover:shadow-lg transition-all duration-300">
                <div class="flex items-start justify-between">
                  <div class="flex-1">
                    <h3 class="text-xl font-semibold mb-3">
                      <a href="{{ .RelPermalink }}" class="text-gray-800 dark:text-gray-200 hover:text-blue-600 dark:hover:text-blue-400">
                        {{ .Title }}
                      </a>
                    </h3>
                    {{ if .Summary }}
                      <p class="text-gray-600 dark:text-gray-400 mb-4 line-clamp-2">
                        {{ .Summary | truncate 180 }}
                      </p>
                    {{ end }}
                    <div class="flex items-center justify-between">
                      <div class="flex items-center space-x-4 text-sm text-gray-500 dark:text-gray-400">
                        <time datetime="{{ .Date.Format "2006-01-02" }}">
                          {{ .Date.Format "2006年1月2日" }}
                        </time>
                        <span>{{ .ReadingTime }}分钟阅读</span>
                        {{ with .Params.categories }}
                          <span class="bg-blue-100 dark:bg-blue-800 text-blue-600 dark:text-blue-400 px-2 py-1 rounded-full text-xs">
                            {{ index . 0 }}
                          </span>
                        {{ end }}
                      </div>
                      {{ with .Params.tags }}
                        <div class="flex space-x-2">
                          {{ range first 3 . }}
                            <span class="bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 px-2 py-1 rounded-full text-xs">
                              #{{ . }}
                            </span>
                          {{ end }}
                        </div>
                      {{ end }}
                    </div>
                  </div>
                  {{ if le (.Params.weight | default 999) 10 }}
                    <div class="ml-4 flex-shrink-0">
                      <span class="bg-red-100 dark:bg-red-900 text-red-600 dark:text-red-400 px-3 py-1 rounded-full text-sm font-medium">
                        📌 置顶
                      </span>
                    </div>
                  {{ end }}
                </div>
              </article>
            {{ end }}
          </div>
        {{ end }}

        <!-- 分页导航 -->
        {{ if or $paginator.HasPrev $paginator.HasNext }}
          <nav class="flex justify-center items-center space-x-1 mt-12">
            {{ if $paginator.HasPrev }}
              <a href="{{ $paginator.Prev.URL }}" class="px-4 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-l-lg hover:bg-gray-50 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">
                « 上一页
              </a>
            {{ else }}
              <span class="px-4 py-2 text-sm font-medium text-gray-300 bg-gray-100 border border-gray-300 rounded-l-lg cursor-not-allowed dark:bg-gray-700 dark:text-gray-500 dark:border-gray-600">
                « 上一页
              </span>
            {{ end }}

            {{ range $paginator.Pagers }}
              {{ if eq . $paginator }}
                <span class="px-4 py-2 text-sm font-medium text-blue-600 bg-blue-50 border border-blue-300 dark:bg-blue-900 dark:text-blue-300 dark:border-blue-700">
                  {{ .PageNumber }}
                </span>
              {{ else }}
                <a href="{{ .URL }}" class="px-4 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 hover:bg-gray-50 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">
                  {{ .PageNumber }}
                </a>
              {{ end }}
            {{ end }}

            {{ if $paginator.HasNext }}
              <a href="{{ $paginator.Next.URL }}" class="px-4 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-r-lg hover:bg-gray-50 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">
                下一页 »
              </a>
            {{ else }}
              <span class="px-4 py-2 text-sm font-medium text-gray-300 bg-gray-100 border border-gray-300 rounded-r-lg cursor-not-allowed dark:bg-gray-700 dark:text-gray-500 dark:border-gray-600">
                下一页 »
              </span>
            {{ end }}
          </nav>

          <!-- 分页信息 -->
          <div class="text-center mt-4 text-sm text-gray-500 dark:text-gray-400">
            第 {{ $paginator.PageNumber }} 页，共 {{ $paginator.TotalPages }} 页
          </div>
        {{ end }}
      </section>
    {{ else }}
      <div class="text-center py-12">
        <p class="text-gray-500 dark:text-gray-400 text-lg">
          还没有发布任何文章，敬请期待！
        </p>
      </div>
    {{ end }}
  </div>
{{ end }}